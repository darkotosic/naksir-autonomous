<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Naksir Autonomous Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #02030a;
      --bg-elevated: #05081a;
      --bg-elevated-soft: #070b20;
      --accent: #ff2ef5;
      --accent-soft: rgba(255, 46, 245, 0.18);
      --accent-alt: #2efcff;
      --accent-alt-soft: rgba(46, 252, 255, 0.18);
      --text: #f5f7ff;
      --text-muted: #8c93c9;
      --border-subtle: #15193a;
      --danger: #ff4b6e;
      --success: #4bffb3;
      --warning: #ffd166;
      --radius-lg: 16px;
      --radius-md: 12px;
      --radius-pill: 999px;
      --shadow-soft: 0 20px 40px rgba(0, 0, 0, 0.65);
      --shadow-card: 0 16px 28px rgba(3, 4, 20, 0.85);
      --transition-fast: 0.15s ease-out;
      --transition-med: 0.22s ease;
      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      height: 100%;
    }

    body {
      font-family: var(--font-sans);
      background:
        radial-gradient(circle at 0% 0%, rgba(255, 46, 245, 0.14), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(46, 252, 255, 0.12), transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(67, 97, 238, 0.12), transparent 50%),
        linear-gradient(135deg, #02030a 0%, #020414 40%, #01020a 100%);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }

    .page-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
    }

    .shell-inner {
      width: 100%;
      max-width: 1120px;
      margin: 24px auto 32px auto;
      padding: 0 16px;
    }

    header.app-header {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 16px;
    }

    .app-badge-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .brand-lockup {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 44px;
      height: 44px;
      border-radius: 14px;
      background:
        radial-gradient(circle at 20% 0%, rgba(255, 46, 245, 0.9), transparent 60%),
        radial-gradient(circle at 80% 100%, rgba(46, 252, 255, 0.75), transparent 60%),
        linear-gradient(135deg, #06071a, #050616);
      border: 1px solid rgba(255, 255, 255, 0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 18px rgba(255, 46, 245, 0.28);
      position: relative;
      overflow: hidden;
    }

    .brand-logo::before {
      content: "";
      position: absolute;
      inset: 1px;
      border-radius: inherit;
      border: 1px solid rgba(255, 255, 255, 0.06);
      opacity: 0.9;
    }

    .brand-logo-mark {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #ffffff;
      text-shadow: 0 0 12px rgba(0, 0, 0, 0.85);
    }

    .brand-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .app-title {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .app-title span.accent {
      background: linear-gradient(120deg, var(--accent), var(--accent-alt));
      -webkit-background-clip: text;
      color: transparent;
    }

    .app-subtitle {
      font-size: 13px;
      color: var(--text-muted);
      letter-spacing: 0.02em;
    }

    .meta-pill-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .meta-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      font-size: 11px;
      background: rgba(8, 11, 35, 0.9);
      border: 1px solid rgba(54, 58, 115, 0.9);
      color: var(--text-muted);
    }

    .meta-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent-alt);
      box-shadow: 0 0 8px rgba(46, 252, 255, 0.7);
    }

    main.app-main {
      border-radius: 24px;
      background: radial-gradient(circle at 0% 0%, rgba(255, 46, 245, 0.14), transparent 60%),
        radial-gradient(circle at 100% 0%, rgba(46, 252, 255, 0.09), transparent 55%),
        linear-gradient(150deg, rgba(4, 8, 30, 0.96), rgba(3, 4, 18, 0.98));
      padding: 16px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(35, 40, 90, 0.9);
      backdrop-filter: blur(26px);
    }

    .tabs-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      border-radius: 999px;
      padding: 4px;
      background: radial-gradient(circle at 0% 0%, rgba(255, 46, 245, 0.08), transparent 60%),
        linear-gradient(120deg, rgba(7, 10, 40, 0.95), rgba(4, 5, 22, 0.98));
      border: 1px solid rgba(31, 35, 80, 0.98);
      margin-bottom: 16px;
    }

    .tab-button {
      flex: 1;
      min-width: 140px;
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: transparent;
      color: var(--text-muted);
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      position: relative;
      transition: background var(--transition-med), color var(--transition-med),
        transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    .tab-button span.label {
      white-space: nowrap;
    }

    .tab-button span.badge {
      font-size: 11px;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(115, 122, 203, 0.7);
      color: var(--text-muted);
      background: rgba(10, 13, 40, 0.95);
    }

    .tab-button:hover {
      color: #ffffff;
      background: rgba(42, 49, 115, 0.65);
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(5, 8, 40, 0.85);
    }

    .tab-button.active {
      color: #ffffff;
      background: radial-gradient(circle at 0 0, rgba(255, 46, 245, 0.3), transparent 60%),
        linear-gradient(135deg, rgba(11, 17, 70, 1), rgba(6, 9, 40, 1));
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.85),
        0 0 24px rgba(255, 46, 245, 0.45);
    }

    .tab-button.active span.badge {
      border-color: var(--accent-alt);
      color: var(--accent-alt);
      background: rgba(6, 16, 40, 1);
    }

    .tabs-content {
      border-radius: 20px;
      border: 1px solid rgba(26, 31, 80, 0.95);
      background: radial-gradient(circle at 0% 0%, rgba(255, 46, 245, 0.08), transparent 65%),
        radial-gradient(circle at 100% 100%, rgba(46, 252, 255, 0.06), transparent 65%),
        linear-gradient(150deg, rgba(5, 8, 36, 0.98), rgba(0, 0, 0, 0.98));
      padding: 16px 16px 14px 16px;
      min-height: 320px;
    }

    .tab-panel {
      display: none;
      animation: fadeIn 0.18s ease-out;
    }

    .tab-panel.active {
      display: block;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    .panel-title {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-title span.accent-line {
      display: inline-flex;
      width: 30px;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), var(--accent-alt));
    }

    .panel-subtitle {
      font-size: 12px;
      color: var(--text-muted);
    }

    .panel-meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: flex-end;
      font-size: 11px;
      color: var(--text-muted);
    }

    .pill-meta {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      background: rgba(8, 10, 34, 0.95);
      border: 1px solid rgba(38, 42, 90, 0.9);
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 10px rgba(255, 46, 245, 0.7);
    }

    .pill-dot.green {
      background: var(--success);
      box-shadow: 0 0 10px rgba(75, 255, 179, 0.7);
    }

    .pill-dot.orange {
      background: var(--warning);
      box-shadow: 0 0 10px rgba(255, 209, 102, 0.7);
    }

    .pill-dot.red {
      background: var(--danger);
      box-shadow: 0 0 10px rgba(255, 75, 110, 0.7);
    }

    .status-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(134, 140, 219, 0.8);
      font-size: 11px;
    }

    .status-chip span.icon {
      font-size: 12px;
    }

    .status-chip.pending {
      border-color: var(--warning);
      color: var(--warning);
    }

    .status-chip.win {
      border-color: var(--success);
      color: var(--success);
    }

    .status-chip.lose {
      border-color: var(--danger);
      color: var(--danger);
    }

    .status-chip.partial {
      border-color: var(--accent-alt);
      color: var(--accent-alt);
    }

    .loader,
    .error-box,
    .empty-box {
      border-radius: var(--radius-md);
      border: 1px dashed rgba(84, 91, 169, 0.9);
      background: rgba(6, 8, 30, 0.95);
      padding: 14px 12px;
      font-size: 13px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 4px;
    }

    .loader::before {
      content: "";
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid rgba(110, 118, 220, 0.6);
      border-top-color: var(--accent-alt);
      animation: spin 0.8s linear infinite;
    }

    .error-box {
      border-style: solid;
      border-color: rgba(255, 75, 110, 0.8);
      background: rgba(16, 4, 18, 0.98);
      color: #ffc2d2;
    }

    .error-box::before {
      content: "!";
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(255, 75, 110, 0.9);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
    }

    .empty-box::before {
      content: "‚Ñπ";
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(120, 127, 210, 0.85);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
    }

    .tickets-grid {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-top: 6px;
    }

    .ticket-set-card {
      border-radius: var(--radius-lg);
      background: radial-gradient(circle at 0% 0%, rgba(255, 46, 245, 0.15), transparent 65%),
        radial-gradient(circle at 100% 100%, rgba(46, 252, 255, 0.08), transparent 65%),
        linear-gradient(150deg, #060821, #040517);
      border: 1px solid rgba(54, 60, 130, 0.95);
      padding: 12px 14px 12px 14px;
      box-shadow: var(--shadow-card);
      position: relative;
      overflow: hidden;
    }

    .ticket-set-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0% 0%, rgba(255, 255, 255, 0.06), transparent 50%);
      mix-blend-mode: soft-light;
      opacity: 0.85;
      pointer-events: none;
    }

    .ticket-set-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 8px;
      position: relative;
      z-index: 1;
    }

    .ticket-set-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ticket-set-label {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #ffffff;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ticket-set-code {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(150, 157, 240, 1);
      font-size: 11px;
      color: rgba(213, 217, 255, 0.98);
      background: rgba(6, 11, 40, 0.96);
    }

    .ticket-set-description {
      font-size: 11px;
      color: var(--text-muted);
    }

    .ticket-set-meta {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .ticket-set-meta span {
      white-space: nowrap;
    }

    .ticket-list {
      margin-top: 6px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 10px;
      position: relative;
      z-index: 1;
    }

    .ticket-card {
      border-radius: var(--radius-md);
      background: linear-gradient(145deg, rgba(6, 9, 38, 0.98), rgba(4, 5, 22, 0.98));
      border: 1px solid rgba(48, 55, 118, 0.98);
      padding: 10px 10px 10px 11px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      transition: transform var(--transition-fast),
        box-shadow var(--transition-fast), border-color var(--transition-fast),
        background var(--transition-fast);
      cursor: default;
      position: relative;
      overflow: hidden;
    }

    .ticket-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(255, 46, 245, 0.18), transparent 55%);
      opacity: 0;
      transition: opacity var(--transition-med);
      pointer-events: none;
    }

    .ticket-card:hover {
      transform: translateY(-2px) translateZ(0);
      box-shadow: 0 18px 28px rgba(0, 0, 0, 0.85);
      border-color: rgba(132, 139, 255, 0.95);
      background: linear-gradient(145deg, rgba(7, 12, 48, 1), rgba(5, 6, 26, 1));
    }

    .ticket-card:hover::before {
      opacity: 1;
    }

    .ticket-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
    }

    .ticket-card-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ticket-card-title {
      font-size: 12px;
      font-weight: 600;
      color: #ffffff;
    }

    .ticket-card-id {
      font-size: 11px;
      color: var(--text-muted);
    }

    .ticket-card-metrics {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 2px;
      font-size: 11px;
    }

    .metric-pill {
      border-radius: 999px;
      padding: 2px 7px;
      background: rgba(7, 10, 35, 0.98);
      border: 1px solid rgba(82, 90, 168, 0.98);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .metric-pill span.metric-label {
      font-weight: 500;
      color: rgba(205, 211, 255, 0.98);
    }

    .metric-pill span.metric-value {
      color: var(--accent-alt);
    }

    .metric-pill.odds span.metric-value {
      color: var(--accent);
    }

    .metric-pill.legs span.metric-value {
      color: var(--accent-alt);
    }

    .ticket-card-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
    }

    .risk-tags-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .risk-tag {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(133, 141, 219, 0.9);
      color: rgba(196, 202, 255, 0.95);
      background: rgba(8, 10, 36, 0.98);
    }

    .risk-tag.red {
      border-color: rgba(255, 75, 110, 0.9);
      color: rgba(255, 187, 199, 0.98);
      background: rgba(28, 4, 10, 0.98);
    }

    .risk-tag.orange {
      border-color: rgba(255, 209, 102, 0.9);
      color: rgba(255, 235, 193, 0.98);
      background: rgba(30, 22, 8, 0.98);
    }

    .risk-tag.green {
      border-color: rgba(75, 255, 179, 0.9);
      color: rgba(220, 255, 241, 0.98);
      background: rgba(8, 28, 20, 0.98);
    }

    .deep-link-btn {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(129, 137, 225, 0.95);
      background: radial-gradient(circle at 0% 0%, rgba(46, 252, 255, 0.18), transparent 60%),
        linear-gradient(120deg, rgba(8, 14, 56, 0.98), rgba(6, 7, 30, 0.98));
      color: rgba(224, 229, 255, 0.98);
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.02em;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background var(--transition-med), transform var(--transition-fast),
        box-shadow var(--transition-fast), border-color var(--transition-fast);
      text-decoration: none;
    }

    .deep-link-btn span.icon {
      font-size: 12px;
    }

    .deep-link-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.9);
      border-color: var(--accent-alt);
      background: radial-gradient(circle at 0% 0%, rgba(46, 252, 255, 0.28), transparent 60%),
        linear-gradient(120deg, rgba(12, 20, 80, 0.98), rgba(6, 6, 30, 0.98));
    }

    .btts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 10px;
      margin-top: 4px;
    }

    .btts-card {
      border-radius: var(--radius-md);
      background: linear-gradient(140deg, rgba(7, 10, 38, 0.96), rgba(4, 5, 22, 0.98));
      border: 1px solid rgba(50, 57, 122, 0.98);
      padding: 10px 11px;
      cursor: pointer;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast),
        border-color var(--transition-fast), background var(--transition-fast);
      position: relative;
      overflow: hidden;
    }

    .btts-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(255, 46, 245, 0.2), transparent 55%);
      opacity: 0;
      transition: opacity var(--transition-med);
      pointer-events: none;
    }

    .btts-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 26px rgba(0, 0, 0, 0.95);
      border-color: rgba(152, 159, 240, 1);
      background: linear-gradient(140deg, rgba(8, 13, 55, 1), rgba(4, 5, 22, 1));
    }

    .btts-card:hover::before {
      opacity: 1;
    }

    .btts-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
    }

    .btts-league {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      color: rgba(205, 210, 255, 0.98);
    }

    .btts-league span.country {
      color: var(--text-muted);
      text-transform: none;
      letter-spacing: normal;
    }

    .btts-teams {
      margin-top: 4px;
      font-size: 13px;
      font-weight: 600;
    }

    .btts-teams span.vs {
      font-weight: 400;
      color: var(--text-muted);
    }

    .btts-kickoff {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .btts-meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-top: 6px;
      font-size: 11px;
    }

    .badge {
      border-radius: 999px;
      padding: 2px 7px;
      border: 1px solid rgba(132, 139, 225, 0.95);
      background: rgba(9, 12, 40, 0.98);
      color: rgba(210, 216, 255, 0.98);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .badge.accent {
      border-color: var(--accent);
      color: var(--accent);
      background: var(--accent-soft);
    }

    .badge.soft {
      border-style: dashed;
      color: var(--text-muted);
    }

    .evaluation-list {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 420px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .evaluation-row {
      border-radius: var(--radius-md);
      border: 1px solid rgba(52, 59, 121, 0.98);
      background: linear-gradient(150deg, rgba(7, 10, 38, 0.96), rgba(3, 4, 18, 0.98));
      padding: 8px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      font-size: 12px;
    }

    .evaluation-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .evaluation-title {
      font-weight: 500;
    }

    .evaluation-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .evaluation-meta {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .evaluation-meta span strong {
      color: rgba(213, 219, 255, 0.98);
    }

    .evaluation-list::-webkit-scrollbar {
      width: 6px;
    }

    .evaluation-list::-webkit-scrollbar-track {
      background: rgba(7, 9, 36, 0.9);
      border-radius: 999px;
    }

    .evaluation-list::-webkit-scrollbar-thumb {
      background: rgba(92, 98, 173, 0.9);
      border-radius: 999px;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(255, 46, 245, 0.08), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(46, 252, 255, 0.08), transparent 55%),
        rgba(1, 1, 10, 0.94);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .modal-backdrop.active {
      display: flex;
    }

    .modal {
      width: min(620px, calc(100% - 24px));
      max-height: min(520px, calc(100% - 40px));
      background: radial-gradient(circle at 0 0, rgba(255, 46, 245, 0.18), transparent 65%),
        radial-gradient(circle at 100% 100%, rgba(46, 252, 255, 0.14), transparent 65%),
        linear-gradient(150deg, #060821, #02030f);
      border-radius: 20px;
      border: 1px solid rgba(62, 68, 140, 0.98);
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.96);
      padding: 14px 14px 12px 14px;
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: hidden;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
    }

    .modal-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .modal-title {
      font-size: 15px;
      font-weight: 600;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .modal-title span.light {
      color: var(--text-muted);
      font-weight: 400;
    }

    .modal-subtitle {
      font-size: 11px;
      color: var(--text-muted);
    }

    .modal-close-btn {
      border-radius: 999px;
      width: 28px;
      height: 28px;
      border: 1px solid rgba(129, 137, 225, 0.95);
      background: rgba(7, 9, 36, 0.98);
      color: rgba(224, 229, 255, 0.98);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 13px;
      transition: background var(--transition-fast), transform var(--transition-fast),
        box-shadow var(--transition-fast), border-color var(--transition-fast);
    }

    .modal-close-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.95);
      border-color: var(--accent);
      background: rgba(16, 12, 52, 0.98);
    }

    .modal-body {
      margin-top: 4px;
      padding-top: 6px;
      border-top: 1px solid rgba(50, 56, 120, 0.95);
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.1fr);
      gap: 10px;
      font-size: 11px;
      max-height: 360px;
      overflow-y: auto;
      padding-right: 4px;
    }

    @media (max-width: 720px) {
      .modal-body {
        grid-template-columns: minmax(0, 1fr);
      }

      .ticket-set-card {
        padding: 10px 10px 9px 10px;
      }

      .ticket-list {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .modal-section-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 4px;
      color: rgba(205, 210, 255, 0.98);
    }

    .modal-section {
      border-radius: 12px;
      border: 1px solid rgba(47, 54, 120, 0.98);
      background: rgba(5, 8, 34, 0.96);
      padding: 8px 9px;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 3px;
    }

    .stat-row:last-child {
      margin-bottom: 0;
    }

    .stat-label {
      color: var(--text-muted);
    }

    .stat-value {
      color: rgba(213, 219, 255, 0.98);
    }

    .h2h-list {
      margin-top: 2px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .h2h-item {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      border-radius: 8px;
      background: rgba(7, 10, 36, 0.96);
      padding: 4px 6px;
    }

    .h2h-main {
      font-size: 11px;
    }

    .h2h-meta {
      font-size: 10px;
      color: var(--text-muted);
      text-align: right;
    }

    .h2h-highlight {
      color: var(--accent-alt);
      font-weight: 500;
    }

    .modal-body::-webkit-scrollbar {
      width: 6px;
    }

    .modal-body::-webkit-scrollbar-track {
      background: rgba(4, 6, 24, 0.9);
      border-radius: 999px;
    }

    .modal-body::-webkit-scrollbar-thumb {
      background: rgba(92, 98, 173, 0.9);
      border-radius: 999px;
    }

    footer.app-footer {
      margin-top: 12px;
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    footer.app-footer span strong {
      color: rgba(212, 218, 255, 0.98);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(2px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body>
  <div class="page-shell">
    <div class="shell-inner">
      <header class="app-header">
        <div class="app-badge-row">
          <div class="brand-lockup">
            <div class="brand-logo">
              <div class="brand-logo-mark">NKI</div>
            </div>
            <div class="brand-title-block">
              <div class="app-title">
                <span class="accent">Naksir</span>
                <span>Autonomous</span>
              </div>
              <div class="app-subtitle">
                Daily tickets, BTTS feed & evaluation ‚Äî fully automated API-Football pipeline.
              </div>
            </div>
          </div>
          <div class="meta-pill-row">
            <div class="meta-pill">
              <div class="meta-dot"></div>
              <span id="meta-date">Date: ‚Äî</span>
            </div>
            <div class="meta-pill">
              <div class="meta-dot"></div>
              <span id="meta-updated">Last update: ‚Äî</span>
            </div>
          </div>
        </div>
      </header>

      <main class="app-main">
        <nav class="tabs-row">
          <button class="tab-button active" data-tab="tickets">
            <span class="label">Today‚Äôs Tickets</span>
            <span class="badge" id="badge-tickets">‚Äî</span>
          </button>
          <button class="tab-button" data-tab="btts">
            <span class="label">BTTS Feed</span>
            <span class="badge" id="badge-btts">‚Äî</span>
          </button>
          <button class="tab-button" data-tab="evaluation">
            <span class="label">Evaluation</span>
            <span class="badge" id="badge-eval">‚Äî</span>
          </button>
        </nav>

        <section class="tabs-content">
          <div class="tab-panel active" id="tab-tickets">
            <div class="panel-header">
              <div>
                <div class="panel-title">
                  <span class="accent-line"></span>
                  <span>Today‚Äôs Tickets</span>
                </div>
                <div class="panel-subtitle">
                  Core Naksir 2+ ticket sets generisani iz AI-driven builder engine-a.
                </div>
              </div>
              <div class="panel-meta-row" id="tickets-meta-row"></div>
            </div>
            <div id="tickets-content"></div>
          </div>

          <div class="tab-panel" id="tab-btts">
            <div class="panel-header">
              <div>
                <div class="panel-title">
                  <span class="accent-line"></span>
                  <span>BTTS Feed</span>
                </div>
                <div class="panel-subtitle">
                  Morning BTTS YES shortlist za top lige, sa fokusom na stabilan goal-flow.
                </div>
              </div>
              <div class="panel-meta-row" id="btts-meta-row"></div>
            </div>
            <div id="btts-content"></div>
          </div>

          <div class="tab-panel" id="tab-evaluation">
            <div class="panel-header">
              <div>
                <div class="panel-title">
                  <span class="accent-line"></span>
                  <span>Evaluation</span>
                </div>
                <div class="panel-subtitle">
                  Rezultati prethodnih tiketa i dnevni status WIN / LOSE / PENDING.
                </div>
              </div>
              <div class="panel-meta-row" id="eval-meta-row"></div>
            </div>
            <div id="eval-content"></div>
          </div>
        </section>

        <footer class="app-footer">
          <span>
            <strong>Naksir Autonomous</strong> ¬∑ API-Football ¬∑ GitHub Pages JSON feeds ¬∑ Telegram bridge ready.
          </span>
          <span id="footer-note">Feed status: idle.</span>
        </footer>
      </main>
    </div>
  </div>

  <div class="modal-backdrop" id="modal-backdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="modal-header">
        <div class="modal-title-block">
          <div class="modal-title" id="modal-title">
            BTTS Detail
            <span class="light">¬∑</span>
            <span id="modal-league"></span>
          </div>
          <div class="modal-subtitle" id="modal-subtitle"></div>
        </div>
        <button class="modal-close-btn" id="modal-close-btn" title="Close">
          ‚úï
        </button>
      </div>
      <div class="modal-body">
        <div class="modal-section">
          <div class="modal-section-title">Teams & odds</div>
          <div id="modal-teams"></div>
        </div>
        <div class="modal-section">
          <div class="modal-section-title">Form & H2H snapshot</div>
          <div id="modal-stats"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Base URL za JSON feedove (po potrebi promeni na svoj Pages root)
    const FEED_BASE = ".";
    const endpoints = {
      tickets: FEED_BASE + "/tickets.json",
      btts: FEED_BASE + "/btts.json",
      bttsStats: FEED_BASE + "/btts.stats.json",
      evaluation: FEED_BASE + "/evaluation.json",
};


    let ticketsData = null;
    let bttsData = null;
    let bttsStatsData = null;
    let evaluationData = null;

    const metaDateEl = document.getElementById("meta-date");
    const metaUpdatedEl = document.getElementById("meta-updated");
    const footerNoteEl = document.getElementById("footer-note");

    const ticketsBadge = document.getElementById("badge-tickets");
    const bttsBadge = document.getElementById("badge-btts");
    const evalBadge = document.getElementById("badge-eval");

    const ticketsMetaRow = document.getElementById("tickets-meta-row");
    const bttsMetaRow = document.getElementById("btts-meta-row");
    const evalMetaRow = document.getElementById("eval-meta-row");

    const ticketsContent = document.getElementById("tickets-content");
    const bttsContent = document.getElementById("btts-content");
    const evalContent = document.getElementById("eval-content");

    const tabButtons = document.querySelectorAll(".tab-button");
    const tabPanels = {
      tickets: document.getElementById("tab-tickets"),
      btts: document.getElementById("tab-btts"),
      evaluation: document.getElementById("tab-evaluation"),
    };

    const modalBackdrop = document.getElementById("modal-backdrop");
    const modalCloseBtn = document.getElementById("modal-close-btn");
    const modalTitleEl = document.getElementById("modal-title");
    const modalLeagueEl = document.getElementById("modal-league");
    const modalSubtitleEl = document.getElementById("modal-subtitle");
    const modalTeamsEl = document.getElementById("modal-teams");
    const modalStatsEl = document.getElementById("modal-stats");

    function formatDateTime(dtString) {
      if (!dtString) return "‚Äî";
      try {
        const dt = new Date(dtString);
        if (isNaN(dt.getTime())) return dtString;
        return dt.toLocaleString(undefined, {
          year: "numeric",
          month: "short",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
        });
      } catch {
        return dtString;
      }
    }

    function formatTime(dtString) {
      if (!dtString) return "‚Äî";
      try {
        const dt = new Date(dtString);
        if (isNaN(dt.getTime())) return dtString;
        return dt.toLocaleTimeString(undefined, {
          hour: "2-digit",
          minute: "2-digit",
        });
      } catch {
        return dtString;
      }
    }

    function formatShortDate(dtString) {
      if (!dtString) return "‚Äî";
      try {
        const dt = new Date(dtString);
        if (isNaN(dt.getTime())) return dtString;
        return dt.toLocaleDateString(undefined, {
          month: "short",
          day: "2-digit",
        });
      } catch {
        return dtString;
      }
    }

    function statusClassFromStatus(status) {
      switch ((status || "").toUpperCase()) {
        case "WIN":
          return "win";
        case "LOSE":
          return "lose";
        case "PARTIAL":
          return "partial";
        case "PENDING":
        default:
          return "pending";
      }
    }

    function statusEmoji(status) {
      switch ((status || "").toUpperCase()) {
        case "WIN":
          return "‚úÖ";
        case "LOSE":
          return "‚ùå";
        case "PARTIAL":
          return "‚ö†Ô∏è";
        case "PENDING":
        default:
          return "‚è≥";
      }
    }

    function showLoader(targetEl, message) {
      targetEl.innerHTML =
        '<div class="loader">' + (message || "Loading feed‚Ä¶") + "</div>";
    }

    function showError(targetEl, message) {
      targetEl.innerHTML =
        '<div class="error-box">' +
        (message || "Unable to load data. Please try again.") +
        "</div>";
    }

    function showEmpty(targetEl, message) {
      targetEl.innerHTML =
        '<div class="empty-box">' +
        (message || "No data available for this section.") +
        "</div>";
    }

    function setFooterStatus(text) {
      footerNoteEl.textContent = text;
    }

    function switchTab(tabKey) {
      tabButtons.forEach((btn) => {
        const key = btn.getAttribute("data-tab");
        if (key === tabKey) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });

      Object.entries(tabPanels).forEach(([key, panel]) => {
        if (key === tabKey) {
          panel.classList.add("active");
        } else {
          panel.classList.remove("active");
        }
      });

      if (tabKey === "tickets") {
        ensureTicketsLoaded();
      } else if (tabKey === "btts") {
        ensureBttsLoaded();
      } else if (tabKey === "evaluation") {
        ensureEvaluationLoaded();
      }
    }

    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const key = btn.getAttribute("data-tab");
        if (!key) return;
        switchTab(key);
      });
    });

    function ensureTicketsLoaded() {
      if (ticketsData) {
        renderTickets();
        return;
      }
      showLoader(ticketsContent, "Loading today‚Äôs tickets from feed‚Ä¶");
      setFooterStatus("Loading tickets.json‚Ä¶");
      fetch(endpoints.tickets, { cache: "no-store" })
        .then((res) => {
          if (!res.ok) throw new Error("HTTP " + res.status);
          return res.json();
        })
        .then((data) => {
          ticketsData = data;
          renderTickets();
          updateGlobalMetaFromTickets(data);
          setFooterStatus("Tickets feed loaded.");
        })
        .catch((err) => {
          console.error("Tickets fetch error:", err);
          showError(
            ticketsContent,
            "Could not load tickets.json. Check GitHub Pages or network."
          );
          setFooterStatus("Tickets feed error.");
        });
    }

    function updateGlobalMetaFromTickets(data) {
      if (!data) return;
      if (data.date) {
        metaDateEl.textContent = "Date: " + data.date;
      }
      if (data.generated_at || (data.meta && data.meta.generated_at)) {
        const ts =
          data.generated_at ||
          (data.meta && data.meta.generated_at) ||
          null;
        metaUpdatedEl.textContent = "Last update: " + formatDateTime(ts);
      }

      const totalTickets =
        (data.meta && data.meta.tickets_after_filter) ||
        (Array.isArray(data.sets)
          ? data.sets.reduce(
              (acc, s) => acc + (Array.isArray(s.tickets) ? s.tickets.length : 0),
              0
            )
          : 0);
      ticketsBadge.textContent =
        totalTickets && totalTickets > 0
          ? totalTickets + " tickets"
          : "No tickets";

      const fixturesCount = data.meta && data.meta.fixtures_count;
      const oddsCount = data.meta && data.meta.odds_count;
      const setsTotal = data.summary && data.summary.sets_total;
      const analMode = data.analysis_mode || "autonomous";

      const parts = [];
      if (fixturesCount) {
        parts.push(
          '<div class="pill-meta"><span class="pill-dot green"></span>' +
            fixturesCount +
            " fixtures</div>"
        );
      }
      if (oddsCount) {
        parts.push(
          '<div class="pill-meta"><span class="pill-dot"></span>' +
            oddsCount +
            " odds rows</div>"
        );
      }
      if (setsTotal != null) {
        parts.push(
          '<div class="pill-meta"><span class="pill-dot orange"></span>' +
            setsTotal +
            " sets</div>"
        );
      }
      parts.push(
        '<div class="pill-meta"><span class="pill-dot"></span>Mode: ' +
          analMode +
          "</div>"
      );
      ticketsMetaRow.innerHTML = parts.join("");
    }

    function renderTickets() {
      const data = ticketsData;
      if (!data) {
        showEmpty(
          ticketsContent,
          "Tickets feed is not available for this day."
        );
        return;
      }
      const sets = Array.isArray(data.sets) ? data.sets : [];
      if (!sets.length) {
        showEmpty(
          ticketsContent,
          "No ticket sets have been published for today."
        );
        return;
      }

      const setCardsHtml = sets
        .map((set) => {
          const code = set.code || set.id || "SET";
          const label = set.label || "Ticket set";
          const desc =
            set.description ||
            "Automated mix of legs generated by builder engine.";
          const tickets = Array.isArray(set.tickets) ? set.tickets : [];

          const totalTickets = tickets.length;
          const avgOdds =
            totalTickets > 0
              ? (
                  tickets.reduce(
                    (acc, t) => acc + (Number(t.total_odds || 0) || 0),
                    0
                  ) / totalTickets
                ).toFixed(2)
              : null;

          const ticketCardsHtml = tickets
            .map((t) => {
              const ticketId = t.ticket_id || t.id || "TICKET";
              const title = t.label || t.code || ticketId;
              const totalOdds = t.total_odds || t.odds || null;
              const legs = Array.isArray(t.legs) ? t.legs : [];
              const aiScore =
                typeof t.ai_score === "number" ? t.ai_score : null;
              const riskTags = Array.isArray(t.risk_tags)
                ? t.risk_tags
                : [];

              const deepLink =
                "naksir-ultimate-2plus://ticket?set=" +
                encodeURIComponent(code) +
                "&ticket=" +
                encodeURIComponent(ticketId);

              const scorePercent =
                aiScore != null ? Math.round(aiScore * 100) + "%" : "‚Äî";

              const riskHtml = riskTags
                .slice(0, 4)
                .map((tag) => {
                  const tagLower = String(tag || "").toLowerCase();
                  let cls = "";
                  if (
                    tagLower.includes("high") ||
                    tagLower.includes("risky")
                  ) {
                    cls = "red";
                  } else if (tagLower.includes("medium")) {
                    cls = "orange";
                  } else if (tagLower.includes("low")) {
                    cls = "green";
                  }
                  return (
                    '<span class="risk-tag ' +
                    cls +
                    '">' +
                    tag +
                    "</span>"
                  );
                })
                .join("");

              return (
                '<article class="ticket-card">' +
                '<div class="ticket-card-header">' +
                '<div class="ticket-card-main">' +
                '<div class="ticket-card-title">' +
                title +
                "</div>" +
                '<div class="ticket-card-id">ID: ' +
                ticketId +
                "</div>" +
                '<div class="ticket-card-metrics">' +
                '<div class="metric-pill odds"><span class="metric-label">Odds</span><span class="metric-value">' +
                (totalOdds ? Number(totalOdds).toFixed(2) : "‚Äî") +
                "</span></div>" +
                '<div class="metric-pill legs"><span class="metric-label">Legs</span><span class="metric-value">' +
                legs.length +
                "</span></div>" +
                '<div class="metric-pill"><span class="metric-label">AI score</span><span class="metric-value">' +
                scorePercent +
                "</span></div>" +
                "</div>" +
                "</div>" +
                "</div>" +
                '<div class="ticket-card-actions">' +
                '<div class="risk-tags-row">' +
                (riskHtml ||
                  '<span class="risk-tag">No risk tags</span>') +
                "</div>" +
                '<button class="deep-link-btn" type="button" data-deeplink="' +
                deepLink +
                '">' +
                '<span class="icon">üì≤</span>' +
                "<span>Open in app</span>" +
                "</a>" +
                "</div>" +
                "</article>"
              );
            })
            .join("");

          return (
            '<section class="ticket-set-card">' +
            '<div class="ticket-set-header">' +
            '<div class="ticket-set-title-block">' +
            '<div class="ticket-set-label">' +
            label +
            '<span class="ticket-set-code">' +
            code +
            "</span>" +
            "</div>" +
            '<div class="ticket-set-description">' +
            desc +
            "</div>" +
            "</div>" +
            '<div class="ticket-set-meta">' +
            "<span>Tickets: <strong>" +
            totalTickets +
            "</strong></span>" +
            "<span>Avg odds: <strong>" +
            (avgOdds || "‚Äî") +
            "</strong></span>" +
            "</div>" +
            "</div>" +
            '<div class="ticket-list">' +
            (ticketCardsHtml ||
              '<div class="empty-box">No tickets in this set.</div>') +
            "</div>" +
            "</section>"
          );
        })
        .join("");

      ticketsContent.innerHTML =
        '<div class="tickets-grid">' + setCardsHtml + "</div>";

      ticketsContent
        .querySelectorAll(".deep-link-btn")
        .forEach((btn) => {
          btn.addEventListener("click", (e) => {
            const link = btn.getAttribute("data-deeplink");
            if (!link) return;
            try {
              window.location.href = link;
            } catch {
              console.warn("Deep link not supported in this environment.");
            }
          });
        });
    }

    function ensureBttsLoaded() {
      if (bttsData) {
        renderBtts();
        return;
      }
      showLoader(bttsContent, "Loading BTTS feed‚Ä¶");
      setFooterStatus("Loading btts.json‚Ä¶");
      fetch(endpoints.btts, { cache: "no-store" })
        .then((res) => {
          if (!res.ok) throw new Error("HTTP " + res.status);
          return res.json();
        })
        .then((data) => {
          bttsData = data;
          renderBtts();
          updateBttsMeta(data);
          setFooterStatus("BTTS feed loaded.");
        })
        .catch((err) => {
          console.error("BTTS fetch error:", err);
          showError(
            bttsContent,
            "Could not load btts.json. Check GitHub Pages or network."
          );
          setFooterStatus("BTTS feed error.");
        });
    }

    function ensureBttsStatsLoaded(callback) {
      if (bttsStatsData) {
        callback && callback();
        return;
      }
      setFooterStatus("Loading btts.stats.json‚Ä¶");
      fetch(endpoints.bttsStats, { cache: "no-store" })
        .then((res) => {
          if (!res.ok) throw new Error("HTTP " + res.status);
          return res.json();
        })
        .then((data) => {
          bttsStatsData = data;
          setFooterStatus("BTTS stats loaded.");
          callback && callback();
        })
        .catch((err) => {
          console.error("BTTS stats fetch error:", err);
          setFooterStatus("BTTS stats error.");
          callback && callback();
        });
    }

    function updateBttsMeta(data) {
      if (!data) return;
      const matchesCount = data.matches_count || data.count || 0;
      const leaguesCount = data.leagues_count || 0;
      const oddsRange = data.odds_range || null;
      const oddsText = oddsRange
        ? (oddsRange.min || "1.20") + "‚Äì" + (oddsRange.max || "1.60")
        : "1.20‚Äì1.60";

      bttsBadge.textContent =
        matchesCount && matchesCount > 0
          ? matchesCount + " matches"
          : "No matches";

      const parts = [];
      parts.push(
        '<div class="pill-meta"><span class="pill-dot green"></span>' +
          matchesCount +
          " picks</div>"
      );
      parts.push(
        '<div class="pill-meta"><span class="pill-dot"></span>' +
          leaguesCount +
          " leagues</div>"
      );
      parts.push(
        '<div class="pill-meta"><span class="pill-dot orange"></span>Odds: ' +
          oddsText +
          "</div>"
      );
      bttsMetaRow.innerHTML = parts.join("");
    }

    function renderBtts() {
      const data = bttsData;
      if (!data) {
        showEmpty(
          bttsContent,
          "BTTS feed is not available for this day."
        );
        return;
      }

      const matches = Array.isArray(data.matches) ? data.matches : [];
      if (!matches.length) {
        showEmpty(
          bttsContent,
          "No BTTS candidates found for the configured leagues."
        );
        return;
      }

      const gridHtml = matches
        .map((m) => {
          const league = m.league || {};
          const home = m.home || {};
          const away = m.away || {};
          const odds = m.odds || m.odd || null;
          const kickoff = m.kickoff || null;
          const pickLabel = m.pick_label || m.pick || "BTTS Yes";

          const leagueName = league.short || league.name || "League";
          const country = league.country || "";
          const fixtureId = m.fixture_id || m.id || null;

          return (
            '<article class="btts-card" data-fixture-id="' +
            fixtureId +
            '">' +
            '<div class="btts-header">' +
            '<div>' +
            '<div class="btts-league">' +
            leagueName +
            (country
              ? ' ¬∑ <span class="country">' + country + "</span>"
              : "") +
            "</div>" +
            '<div class="btts-teams">' +
            (home.name || "Home") +
            ' <span class="vs">vs</span> ' +
            (away.name || "Away") +
            "</div>" +
            '<div class="btts-kickoff">Kickoff: ' +
            formatDateTime(kickoff) +
            "</div>" +
            "</div>" +
            '<div class="status-chip pending">' +
            '<span class="icon">üéØ</span>' +
            "<span>BTTS YES</span>" +
            "</div>" +
            "</div>" +
            '<div class="btts-meta-row">' +
            '<div class="badge accent"><span>Odds</span><strong>' +
            (odds ? Number(odds).toFixed(2) : "‚Äî") +
            "</strong></div>" +
            '<div class="badge soft"><span>Pick</span><strong>' +
            pickLabel +
            "</strong></div>" +
            "</div>" +
            "</article>"
          );
        })
        .join("");

      bttsContent.innerHTML =
        '<div class="btts-grid">' + gridHtml + "</div>";

      bttsContent
        .querySelectorAll(".btts-card")
        .forEach((card) => {
          card.addEventListener("click", () => {
            const fixtureId = card.getAttribute("data-fixture-id");
            if (!fixtureId) return;
            openBttsModal(fixtureId);
          });
        });
    }

    function openBttsModal(fixtureId) {
      if (!bttsData) return;

      const matches = Array.isArray(bttsData.matches)
        ? bttsData.matches
        : [];
      const match = matches.find(
        (m) =>
          String(m.fixture_id || m.id) === String(fixtureId)
      );
      if (!match) return;

      const league = match.league || {};
      const home = match.home || {};
      const away = match.away || {};
      const odds = match.odds || match.odd || null;
      const kickoff = match.kickoff || null;
      const pickLabel =
        match.pick_label || match.pick || "BTTS Yes";

      const leagueName = league.name || league.short || "League";
      const country = league.country || "";

      modalTitleEl.textContent =
        (home.name || "Home") +
        " vs " +
        (away.name || "Away");
      modalLeagueEl.textContent =
        leagueName + (country ? " ¬∑ " + country : "");
      modalSubtitleEl.textContent =
        "Fixture ID: " + (match.fixture_id || match.id || "‚Äî");

      modalTeamsEl.innerHTML =
        '<div class="stat-row"><span class="stat-label">Kickoff</span><span class="stat-value">' +
        formatDateTime(kickoff) +
        "</span></div>" +
        '<div class="stat-row"><span class="stat-label">Pick</span><span class="stat-value">BTTS YES (' +
        pickLabel +
        ")</span></div>" +
        '<div class="stat-row"><span class="stat-label">Odds</span><span class="stat-value">' +
        (odds ? Number(odds).toFixed(2) : "‚Äî") +
        "</span></div>";

      modalStatsEl.innerHTML =
        '<div class="loader">Loading form & H2H snapshot‚Ä¶</div>';

      ensureBttsStatsLoaded(() => {
        const statsRoot = bttsStatsData || {};
        const fixturesMap =
          statsRoot.fixtures && typeof statsRoot.fixtures === "object"
            ? statsRoot.fixtures
            : {};
        const stats =
          fixturesMap[String(fixtureId)] ||
          fixturesMap[Number(fixtureId)] ||
          null;

        if (!stats) {
          modalStatsEl.innerHTML =
            '<div class="empty-box">No extended stats available for this fixture.</div>';
          modalBackdrop.classList.add("active");
          return;
        }

        const homeStats = stats.home || {};
        const awayStats = stats.away || {};
        const h2hObj = stats.h2h || {};

        const homeAvg =
          typeof homeStats.avg_goals === "number"
            ? homeStats.avg_goals.toFixed(2)
            : "‚Äî";
        const awayAvg =
          typeof awayStats.avg_goals === "number"
            ? awayStats.avg_goals.toFixed(2)
            : "‚Äî";

        let bttsRateText = "‚Äî";
        if (typeof h2hObj.btts_rate === "number") {
          const pct =
            h2hObj.btts_rate <= 1
              ? Math.round(h2hObj.btts_rate * 100)
              : Math.round(h2hObj.btts_rate);
          bttsRateText = pct + "%";
        }

        const h2hAvgGoals =
          typeof h2hObj.avg_goals === "number"
            ? h2hObj.avg_goals.toFixed(2)
            : "‚Äî";

        const formBlock =
          '<div class="stat-row"><span class="stat-label">Home avg goals</span><span class="stat-value">' +
          homeAvg +
          "</span></div>" +
          '<div class="stat-row"><span class="stat-label">Away avg goals</span><span class="stat-value">' +
          awayAvg +
          "</span></div>" +
          '<div class="stat-row"><span class="stat-label">Home form</span><span class="stat-value">' +
          (homeStats.form || "‚Äî") +
          "</span></div>" +
          '<div class="stat-row"><span class="stat-label">Away form</span><span class="stat-value">' +
          (awayStats.form || "‚Äî") +
          "</span></div>";

        const h2hSummary =
          '<div class="modal-section-title" style="margin-top:6px;">H2H summary</div>' +
          '<div class="stat-row"><span class="stat-label">BTTS rate</span><span class="stat-value">' +
          bttsRateText +
          "</span></div>" +
          '<div class="stat-row"><span class="stat-label">H2H avg goals</span><span class="stat-value">' +
          h2hAvgGoals +
          "</span></div>";

        modalStatsEl.innerHTML = formBlock + h2hSummary;
        modalBackdrop.classList.add("active");
      });
    }

    function closeModal() {
      modalBackdrop.classList.remove("active");
    }

    modalCloseBtn.addEventListener("click", closeModal);
    modalBackdrop.addEventListener("click", (e) => {
      if (e.target === modalBackdrop) {
        closeModal();
      }
    });

    function ensureEvaluationLoaded() {
      if (evaluationData) {
        renderEvaluation();
        return;
      }
      showLoader(evalContent, "Loading evaluation feed‚Ä¶");
      setFooterStatus("Loading evaluation.json‚Ä¶");
      fetch(endpoints.evaluation, { cache: "no-store" })
        .then((res) => {
          if (!res.ok) throw new Error("HTTP " + res.status);
          return res.json();
        })
        .then((data) => {
          evaluationData = data;
          renderEvaluation();
          updateEvaluationMeta(data);
          setFooterStatus("Evaluation feed loaded.");
        })
        .catch((err) => {
          console.error("Evaluation fetch error:", err);
          showError(
            evalContent,
            "Could not load evaluation.json. Check GitHub Pages or network."
          );
          setFooterStatus("Evaluation feed error.");
        });
    }

    function updateEvaluationMeta(data) {
      if (!data) return;
      const date = data.date || null;
      const generatedAt = data.generated_at || null;
      if (date) {
        metaDateEl.textContent = "Date: " + date;
      }
      if (generatedAt) {
        metaUpdatedEl.textContent =
          "Last update: " + formatDateTime(generatedAt);
      }

      let ticketsCount = 0;
      let wins = 0;
      let loses = 0;
      let pending = 0;

      const ticketsObj =
        (data.tickets && typeof data.tickets === "object" && data.tickets) ||
        null;
      const ticketsArr = Array.isArray(data.tickets)
        ? data.tickets
        : ticketsObj
        ? Object.values(ticketsObj)
        : [];

      ticketsCount = ticketsArr.length;

      ticketsArr.forEach((t) => {
        const status =
          (t.status || t.ticket_status || "").toUpperCase();
        if (status === "WIN") wins += 1;
        else if (status === "LOSE") loses += 1;
        else pending += 1;
      });

      evalBadge.textContent =
        ticketsCount && ticketsCount > 0
          ? ticketsCount + " tickets"
          : "No records";

      const parts = [];
      parts.push(
        '<div class="pill-meta"><span class="pill-dot green"></span>' +
          wins +
          " WIN</div>"
      );
      parts.push(
        '<div class="pill-meta"><span class="pill-dot red"></span>' +
          loses +
          " LOSE</div>"
      );
      parts.push(
        '<div class="pill-meta"><span class="pill-dot orange"></span>' +
          pending +
          " pending</div>"
      );
      evalMetaRow.innerHTML = parts.join("");
    }

    function renderEvaluation() {
      const data = evaluationData;
      if (!data) {
        showEmpty(
          evalContent,
          "Evaluation feed is not available for this day."
        );
        return;
      }

      const ticketsObj =
        (data.tickets && typeof data.tickets === "object" && data.tickets) ||
        null;
      const ticketsArr = Array.isArray(data.tickets)
        ? data.tickets
        : ticketsObj
        ? Object.entries(ticketsObj).map(([id, v]) => ({
            ticket_id: id,
            ...v,
          }))
        : [];

      if (!ticketsArr.length) {
        showEmpty(
          evalContent,
          "No evaluated tickets found. Check back after matches finish."
        );
        return;
      }

      const rowsHtml = ticketsArr
        .sort((a, b) => {
          const aTs = a.updated_at || a.settled_at || a.generated_at || "";
          const bTs = b.updated_at || b.settled_at || b.generated_at || "";
          return String(bTs).localeCompare(String(aTs));
        })
        .map((t) => {
          const id = t.ticket_id || t.id || "TICKET";
          const code = t.code || "";
          const status =
            (t.status || t.ticket_status || "PENDING").toUpperCase();
          const className = statusClassFromStatus(status);
          const emoji = statusEmoji(status);
          const totalOdds = t.total_odds || t.odds || null;
          const legs = Array.isArray(t.legs) ? t.legs : [];
          const updatedAt =
            t.updated_at || t.settled_at || t.generated_at || null;

          return (
            '<div class="evaluation-row">' +
            '<div class="evaluation-main">' +
            '<div class="evaluation-title">' +
            (code ? code + " ¬∑ " : "") +
            id +
            "</div>" +
            '<div class="evaluation-sub">' +
            "Legs: " +
            legs.length +
            " ¬∑ Odds: " +
            (totalOdds ? Number(totalOdds).toFixed(2) : "‚Äî") +
            "</div>" +
            "</div>" +
            '<div class="evaluation-meta">' +
            '<span><strong>' +
            (updatedAt ? formatTime(updatedAt) : "‚Äî") +
            "</strong> ¬∑ " +
            (updatedAt ? formatShortDate(updatedAt) : "") +
            "</span>" +
            '<span class="status-chip ' +
            className +
            '"><span class="icon">' +
            emoji +
            '</span><span>' +
            status +
            "</span></span>" +
            "</div>" +
            "</div>"
          );
        })
        .join("");

      evalContent.innerHTML =
        '<div class="evaluation-list">' + rowsHtml + "</div>";
    }

    document.addEventListener("DOMContentLoaded", () => {
      ensureTicketsLoaded();
    });
  </script>
</body>
</html>
