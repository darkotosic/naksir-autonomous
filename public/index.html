<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Naksir Autonomous Tickets</title>
  <style>
    :root {
      color-scheme: dark;
      --bg: #03060c;
      --panel: rgba(8, 14, 22, 0.8);
      --border: rgba(120, 250, 180, 0.28);
      --text: #e9f5ff;
      --muted: #b8c4d4;
      --accent: #48ff7b;
      --accent-soft: rgba(72, 255, 123, 0.14);
      --accent-2: #00b5ff;
      --shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
      font-family: "Inter", "Sora", system-ui, -apple-system, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at 14% 22%, rgba(72, 255, 123, 0.12), transparent 26%),
        radial-gradient(circle at 86% 12%, rgba(0, 181, 255, 0.14), transparent 28%),
        radial-gradient(circle at 20% 82%, rgba(72, 255, 123, 0.08), transparent 22%),
        linear-gradient(135deg, #050912, #03060c);
      display: flex;
      justify-content: center;
      padding: 32px 16px 44px;
      position: relative;
      overflow-x: hidden;
    }

    body::before,
    body::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      mix-blend-mode: screen;
      opacity: 0.45;
      background: radial-gradient(circle at 30% 10%, rgba(72, 255, 123, 0.14), transparent 30%),
        radial-gradient(circle at 75% 22%, rgba(0, 181, 255, 0.16), transparent 32%),
        radial-gradient(circle at 55% 90%, rgba(72, 255, 123, 0.12), transparent 30%);
      filter: blur(90px);
      z-index: 0;
    }

    .page {
      width: min(1280px, 100%);
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .shell {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow), 0 0 0 1px rgba(72, 255, 123, 0.08);
      overflow: hidden;
      position: relative;
      isolation: isolate;
    }

    .shell::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, rgba(72, 255, 123, 0.08), rgba(0, 181, 255, 0.06));
      opacity: 0.8;
      z-index: 0;
      pointer-events: none;
    }

    .content {
      position: relative;
      z-index: 1;
      padding: 18px 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .top-links {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .ghost-link {
      text-decoration: none;
      color: var(--text);
      padding: 12px 14px;
      text-align: center;
      border-radius: 14px;
      border: 1px solid rgba(72, 255, 123, 0.4);
      background: rgba(72, 255, 123, 0.06);
      box-shadow: 0 0 18px rgba(72, 255, 123, 0.35);
      transition: all 0.2s ease;
      font-weight: 700;
      letter-spacing: 0.4px;
    }

    .ghost-link:hover {
      transform: translateY(-1px) scale(1.01);
      box-shadow: 0 0 28px rgba(72, 255, 123, 0.45), 0 10px 30px rgba(0, 0, 0, 0.35);
    }

    .hero {
      display: grid;
      gap: 12px;
    }

    .eyebrow {
      text-transform: uppercase;
      letter-spacing: 0.4px;
      font-weight: 700;
      color: var(--accent);
      margin: 0;
      font-size: 0.9rem;
    }

    h1 {
      margin: 0;
      font-size: clamp(2.1rem, 2vw + 1.2rem, 2.6rem);
      text-shadow: 0 0 18px rgba(72, 255, 123, 0.45);
    }

    .sub {
      color: var(--muted);
      margin: 0;
      max-width: 840px;
      line-height: 1.6;
    }

    .actions {
      display: grid;
      gap: 12px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 14px 16px;
      border-radius: 14px;
      font-weight: 700;
      letter-spacing: 0.3px;
      border: 1px solid transparent;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      color: #0b1220;
    }

    .btn.primary {
      background: linear-gradient(120deg, #48ff7b, #00ffbf);
      box-shadow: 0 0 24px rgba(72, 255, 123, 0.55), 0 14px 36px rgba(0, 0, 0, 0.45);
      color: #031408;
    }

    .btn.primary:hover {
      transform: translateY(-1px) scale(1.01);
      box-shadow: 0 0 32px rgba(72, 255, 123, 0.7), 0 18px 40px rgba(0, 0, 0, 0.55);
    }

    .btn.telegram {
      background: linear-gradient(120deg, #1f9eff, #42c5ff);
      color: #031220;
      border: 1px solid rgba(66, 197, 255, 0.4);
      box-shadow: 0 0 26px rgba(66, 197, 255, 0.5), 0 16px 32px rgba(0, 0, 0, 0.4);
    }

    .btn.telegram:hover {
      transform: translateY(-1px) scale(1.01);
      box-shadow: 0 0 32px rgba(66, 197, 255, 0.65), 0 20px 38px rgba(0, 0, 0, 0.5);
    }

    .btn.ghost {
      background: rgba(72, 255, 123, 0.08);
      border: 1px solid rgba(72, 255, 123, 0.4);
      color: var(--text);
      box-shadow: 0 0 16px rgba(72, 255, 123, 0.3);
    }

    .btn.ghost:hover {
      box-shadow: 0 0 20px rgba(72, 255, 123, 0.45), 0 12px 30px rgba(0, 0, 0, 0.45);
    }

    .btn.xl {
      padding: 16px 20px;
      font-size: 1.05rem;
    }

    .screens {
      position: relative;
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding: 2px 0 6px;
    }

    .pill {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(72, 255, 123, 0.35);
      background: rgba(72, 255, 123, 0.08);
      color: var(--muted);
      letter-spacing: 0.2px;
      box-shadow: 0 0 14px rgba(72, 255, 123, 0.28);
    }

    .alert {
      padding: 14px 16px;
      border-radius: 14px;
      border: 1px solid rgba(72, 255, 123, 0.35);
      background: rgba(72, 255, 123, 0.08);
      color: var(--text);
      box-shadow: 0 0 20px rgba(72, 255, 123, 0.28);
    }

    .alert.error {
      border-color: rgba(255, 99, 132, 0.55);
      background: rgba(255, 99, 132, 0.12);
      box-shadow: 0 0 20px rgba(255, 99, 132, 0.35);
      color: #ffe6ee;
    }

    .alert.success {
      border-color: rgba(72, 255, 123, 0.6);
      background: rgba(72, 255, 123, 0.1);
    }

    .meta-grid,
    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 10px;
    }

    .metric,
    .status-card {
      padding: 14px 16px;
      border-radius: 14px;
      border: 1px solid rgba(72, 255, 123, 0.28);
      background: rgba(6, 10, 16, 0.7);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35), 0 0 16px rgba(72, 255, 123, 0.22);
    }

    .metric h3,
    .status-card h3 {
      margin: 0 0 4px;
      color: var(--muted);
      font-weight: 600;
      letter-spacing: 0.2px;
    }

    .metric strong,
    .status-card strong {
      font-size: 1.1rem;
    }

    .card {
      border: 1px solid rgba(72, 255, 123, 0.3);
      border-radius: 16px;
      padding: 16px;
      background: linear-gradient(180deg, rgba(8, 14, 22, 0.9), rgba(4, 8, 14, 0.95));
      box-shadow: 0 18px 60px rgba(0, 0, 0, 0.45), 0 0 24px rgba(72, 255, 123, 0.2);
      display: flex;
      flex-direction: column;
      gap: 12px;
      position: relative;
      overflow: hidden;
      isolation: isolate;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 82% 10%, rgba(0, 181, 255, 0.12), transparent 45%);
      opacity: 0;
      transition: opacity 0.2s ease;
      z-index: 0;
    }

    .card:hover::before {
      opacity: 1;
    }

    .card header {
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      z-index: 1;
    }

    .title-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.85rem;
      border: 1px solid rgba(72, 255, 123, 0.4);
      background: rgba(72, 255, 123, 0.12);
      color: var(--text);
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.25), 0 0 18px rgba(72, 255, 123, 0.35);
    }

    .badge.ok { border-color: rgba(72, 255, 123, 0.5); color: #dcffe9; }
    .badge.partial { border-color: rgba(255, 198, 88, 0.55); color: #ffe7b4; background: rgba(255, 198, 88, 0.16); }
    .badge.fallback { border-color: rgba(0, 181, 255, 0.55); color: #d7f2ff; background: rgba(0, 181, 255, 0.18); }
    .badge.error { border-color: rgba(255, 99, 132, 0.6); color: #ffe6ee; background: rgba(255, 99, 132, 0.18); }

    .muted { color: var(--muted); font-size: 0.95rem; }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      position: relative;
      z-index: 1;
    }

    .tag {
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(72, 255, 123, 0.08);
      border: 1px solid rgba(72, 255, 123, 0.28);
      font-size: 0.85rem;
      color: var(--muted);
    }

    .ticket-list {
      display: grid;
      gap: 10px;
      position: relative;
      z-index: 1;
    }

    .ticket {
      border: 1px solid rgba(72, 255, 123, 0.2);
      border-radius: 12px;
      padding: 12px;
      background: rgba(72, 255, 123, 0.06);
      display: grid;
      gap: 10px;
      box-shadow: 0 0 18px rgba(72, 255, 123, 0.16);
    }

    .ticket header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .legs {
      display: grid;
      gap: 8px;
    }

    .leg {
      padding: 9px 10px;
      border-radius: 10px;
      border: 1px dashed rgba(72, 255, 123, 0.28);
      background: rgba(8, 14, 22, 0.85);
    }

    .leg strong { display: block; }

    .section-title {
      margin: 0;
      font-size: 1.1rem;
      letter-spacing: 0.2px;
    }

    @media (max-width: 720px) {
      body {
        padding: 22px 12px 34px;
      }

      .content {
        padding: 16px;
      }

      .btn.xl {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="shell">
      <div class="content screens">
        <section id="homeScreen" class="screen active">
          <nav class="top-links">
            <a class="ghost-link" href="https://naksirpredictions.top/legal-disclaimer" target="_blank" rel="noreferrer">Legal</a>
            <a class="ghost-link" href="https://naksirpredictions.top/privacy-policy" target="_blank" rel="noreferrer">Privacy</a>
            <a class="ghost-link" href="https://naksirpredictions.top/terms-of-use" target="_blank" rel="noreferrer">Terms of Use</a>
          </nav>

          <div class="hero">
            <p class="eyebrow">Naksir Ultimate</p>
            <h1>Futuristički neon UI za 2+ tikete</h1>
            <p class="sub">
              Pregledaj AI generisane tikete sa remote feed-a. Fudbalska neon zelena tema, tamni mod i outglow za svaki CTA.
              Klik na dugme ispod da uđeš u Naksir Ultimate 2+ Tickets hub.
            </p>
            <div class="actions">
              <a class="btn telegram xl" href="https://t.me/naksiranalysis" target="_blank" rel="noreferrer">Telegram</a>
              <button id="openTickets" class="btn primary xl">Cool design · Naksir Ultimate 2+ Tickets</button>
            </div>
          </div>
        </section>

        <section id="ticketsScreen" class="screen">
          <div class="topbar">
            <button id="backBtn" class="btn ghost">← Back</button>
            <div class="pill">Ultimate 2+ Tickets · Live neon feed</div>
          </div>

          <div id="alert" class="alert">Loading ticket sets…</div>

          <div class="meta-grid" id="meta"></div>
          <div class="status-grid" id="statusGrid"></div>

          <div class="cards" id="cards"></div>
        </section>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const safeArray = (v) => (Array.isArray(v) ? v : []);
    const TICKETS_URL = "https://darkotosic.github.io/naksir-autonomous/tickets.json";
    let loadedOnce = false;

    const STATUS_MAP = {
      OK: { label: "OK", cls: "ok" },
      PARTIAL: { label: "Partial", cls: "partial" },
      FALLBACK_1: { label: "Fallback (1 ticket)", cls: "fallback" },
      FALLBACK_2: { label: "Fallback (mix)", cls: "fallback" },
      NO_DATA: { label: "No data", cls: "error" },
      UNKNOWN: { label: "Unknown", cls: "error" },
    };

    function badge(statusRaw) {
      const key = String(statusRaw || "UNKNOWN").toUpperCase();
      const conf = STATUS_MAP[key] || STATUS_MAP.UNKNOWN;
      return `<span class="badge ${conf.cls}">${conf.label}</span>`;
    }

    function fmtDate(iso) {
      if (!iso) return "—";
      const d = new Date(iso);
      return d.toLocaleString(undefined, {
        dateStyle: "medium",
        timeStyle: "short",
      });
    }

    function setAlert(type, message) {
      const el = $("alert");
      el.className = `alert ${type || ""}`.trim();
      el.textContent = message;
    }

    function renderMeta(summary, meta, sets) {
      const metaGrid = $("meta");
      metaGrid.innerHTML = "";

      const items = [
        { label: "Date", value: summary.date || "—" },
        { label: "Generated at", value: fmtDate(summary.generated_at || meta?.generated_at) },
        { label: "AI min score", value: meta?.min_score ? `${meta.min_score.toFixed(1)}+` : "—" },
        { label: "Fixtures (cache)", value: meta?.fixtures_count ?? "—" },
        { label: "Odds rows", value: meta?.odds_count ?? "—" },
        { label: "Raw sets / tickets", value: meta ? `${meta.raw_sets ?? "—"} / ${meta.raw_total_tickets ?? "—"}` : "—" },
        {
          label: "After AI filter",
          value: meta ? `${meta.sets_after_filter ?? "—"} / ${meta.tickets_after_filter ?? "—"}` : "—",
        },
        { label: "Published sets", value: summary.sets_total ?? sets.length },
        { label: "Published tickets", value: summary.tickets_total ?? "—" },
      ];

      items.forEach((item) => {
        const card = document.createElement("div");
        card.className = "metric";
        card.innerHTML = `<h3>${item.label}</h3><strong>${item.value}</strong>`;
        metaGrid.appendChild(card);
      });
    }

    function renderStatusGrid(summary) {
      const grid = $("statusGrid");
      grid.innerHTML = "";

      const statusCounts =
        typeof summary.status_counts === "object" && summary.status_counts !== null ? summary.status_counts : {};
      const keys = Object.keys(statusCounts);
      if (!keys.length) return;

      keys.forEach((key) => {
        const value = statusCounts[key];
        const card = document.createElement("div");
        card.className = "status-card";
        card.innerHTML = `<h3>${key}</h3><strong>${value}</strong>`;
        grid.appendChild(card);
      });
    }

    function renderLeg(leg, index) {
      const league = leg.league_country || leg.country || "";
      const leagueName = leg.league_name || leg.league || "";
      const home = leg.home || leg.teams?.home?.name || "Home";
      const away = leg.away || leg.teams?.away?.name || "Away";
      const kickoff = leg.kickoff || leg.fixture?.date || "";
      const market = leg.market || leg.market_family || "Market";
      const pick = leg.pick || leg.choice || "Pick";
      const odds = leg.odds ?? "—";

      return `
        <div class="leg">
          <strong>Leg ${index + 1} · ${league} ${leagueName}</strong>
          <div class="muted">${fmtDate(kickoff)}</div>
          <div>${home} vs ${away}</div>
          <div class="muted">${market} → ${pick} @ ${odds}</div>
        </div>
      `;
    }

    function renderTicket(ticket) {
      const legs = safeArray(ticket.legs);
      const score = ticket.score != null ? `${ticket.score}%` : "—";
      return `
        <article class="ticket">
          <header>
            <div><strong>${ticket.ticket_id || "Ticket"}</strong></div>
            <div class="tags">
              <span class="tag">Total odds: ${ticket.total_odds ?? "—"}</span>
              <span class="tag">Score: ${score}</span>
            </div>
          </header>
          <div class="legs">
            ${legs.map((leg, i) => renderLeg(leg, i)).join("") || '<div class="muted">No legs found.</div>'}
          </div>
        </article>
      `;
    }

    function renderSetCard(set) {
      const card = document.createElement("article");
      card.className = "card";

      const tickets = safeArray(set.tickets);

      card.innerHTML = `
        <header>
          <div class="title-row">
            <h3 class="section-title">${set.label || set.code || "Ticket set"}</h3>
            ${badge(set.status)}
          </div>
          <div class="muted">Code: ${set.code || "N/A"}</div>
        </header>
        <div class="tags">
          <span class="tag">Tickets: ${tickets.length}</span>
          <span class="tag">Requested: ${set.requested_max_tickets ?? "—"}</span>
          <span class="tag">Effective: ${set.effective_max_tickets ?? "—"}</span>
          <span class="tag">Legs pool: ${set.legs_pool_size ?? "—"}</span>
        </div>
        <div class="ticket-list">
          ${tickets.map(renderTicket).join("") || '<div class="muted">No tickets after AI filter.</div>'}
        </div>
      `;

      return card;
    }

    function renderTickets(data) {
      const cardsEl = $("cards");
      cardsEl.innerHTML = "";

      const sets = safeArray(data.sets);
      const summary = data.summary || { date: data.date, generated_at: data.generated_at };
      const meta = typeof data.meta === "object" ? data.meta : {};

      renderMeta(summary, meta, sets);
      renderStatusGrid(summary);

      if (!sets.length) {
        setAlert("error", "Nema dostupnih setova. Proveri GitHub Pages feed.");
        return;
      }

      setAlert("success", `${sets.length} setova · ${summary.tickets_total ?? "?"} tiketa`);

      sets.forEach((set) => cardsEl.appendChild(renderSetCard(set)));
    }

    async function loadTickets() {
      try {
        setAlert("", "Loading ticket sets…");
        const res = await fetch(TICKETS_URL, { cache: "no-cache" });
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`);
        }
        const data = await res.json();
        renderTickets(data);
        loadedOnce = true;
      } catch (err) {
        console.error(err);
        setAlert("error", `Neuspešno učitavanje tiketa (${err.message}). Proveri remote tickets.json.`);
      }
    }

    function showScreen(id) {
      document.querySelectorAll(".screen").forEach((el) => el.classList.remove("active"));
      const screen = document.getElementById(id);
      if (screen) screen.classList.add("active");
    }

    $("openTickets").addEventListener("click", () => {
      showScreen("ticketsScreen");
      if (!loadedOnce) {
        loadTickets();
      }
    });

    $("backBtn").addEventListener("click", () => {
      showScreen("homeScreen");
    });
  </script>
</body>
</html>
